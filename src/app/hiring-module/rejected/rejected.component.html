<div class="container-fluid">
  <app-nav></app-nav>
</div>

<div class="container-fluid mt-3">
  <div class="row g-2">
    <!-- <div class="col-md-2 mb-2">
        <div class="card border-0 p-0 shadow">
          <div class="card-body p-2">
            <app-asset-manager-side-bar></app-asset-manager-side-bar>
          </div>
        </div>
      </div> -->
    <!-- Right side content -->
    <div class="col-md-12">
      <div class="card py-1 border-0">
        <div class="card-body py-1">

          <div class="row mb-2 align-items-center">
            <div class="col-md-3">
              <span class="fw-bold text-dark">
                <i class="bi bi-chevron-left me-2" style="cursor: pointer;" (click)="goBack()"></i>
                Rejected Candidates
                <span class="badge bg-dark text-white">{{ rows.length }}</span>
              </span>
            </div>
            <div class="col-md-9 d-flex justify-content-end align-items-center">

              <input type="search" class="form-control form-control-sm search-input" placeholder="ðŸ” Search"
                [formControl]="searchQuery" aria-level="Search" style="max-width: 150px; font-size: 13px;">
              <!-- <button type="button" (click)="toggleOffcanvas()" class="btn btn-sm custom-bg text-light">
                  Filter Options
                </button> -->
            </div>
          </div>
          <div class="scroll-container p-0">
            <table class="table table-bordered">
              <thead class="">
                <tr class="text-light">
                  <th *ngFor="let col of columns" class="small-header-th sticky-col"
                    [ngClass]="{'text-center': col.center}">
                    {{ col.label }}
                  </th>
                </tr>
              </thead>
              <tbody *ngIf="paginatedRows.length > 0; else noData">
                <tr *ngFor="let row of paginatedRows" class="table-hoverr">
                  <td *ngFor="let col of columns" class="small-header"
                    [ngClass]="{'text-uppercas': col.uppercase, 'text-center': col.center}">

                    <!-- If the column is clickable (like Action button for candidateId) -->
                    <ng-container *ngIf="col.clickable && col.key === 'candidateId'; else normalCell">
                      <button class="border-none custom-bg text-white custom-action-btn px-2"
                        (click)="handleAction(row[col.key])">
                        View
                      </button>
                    </ng-container>

                    <!-- Normal cell content -->
                    <ng-template #normalCell>
                      <span [innerHTML]="highlightMatch(row[col.key])"></span>
                    </ng-template>

                  </td>
                </tr>
              </tbody>
              <ng-template #noData>
                <tbody>
                  <tr>
                    <td [attr.colspan]="columns.length">
                      <div class="d-flex justify-content-center align-items-center">
                        <div class="">
                          <!-- No data available -->
                          <img
                            src="https://assets-v2.lottiefiles.com/a/92920ca4-1174-11ee-9d90-63f3a87b4e3d/xxNZvglgy1.gif"
                            width="150px" height="150px" alt="">
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </ng-template>
            </table>


          </div>

          <!-- Pagination Controls -->
          <hr *ngIf="rows.length > 0" class="custom-hr mb-2 mt-1">
          <div class="d-flex justify-content-between align-items-center mt-1" *ngIf="rows.length > 0">
            <span class="small badge bg-secondary text-white">
              Showing {{ startIndex }} to {{ endIndex }} of {{ rows.length }} Records
            </span>

            <ul class="pagination pagination-sm mb-1">
              <!-- Always show Previous button but disable if on first page -->
              <li class="page-item" [class.disabled]="currentPage === 1">
                <button type="button" class="border-none text-white custom-action-btn px-2 py-1 mr-2"
                  (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1"
                  [ngClass]="{'custom-bg': currentPage > 1, 'bg-secondary': currentPage === 1}">
                  <i class="bi bi-chevron-left"></i>
                </button>
              </li>

              <li class="page-item mr-2">
                <span class="px-3 py-1 small text-dark fw-bold border rounded bg-light">
                  Page {{ currentPage }} of {{ totalPages }}
                </span>
              </li>
              <!-- Always show Next button but disable if on last page -->
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <button type="button" class="border-none text-white custom-action-btn px-2 py-1 mr-2"
                  (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages"
                  [ngClass]="{'custom-bg': currentPage < totalPages, 'bg-secondary': currentPage === totalPages}">
                  <i class="bi bi-chevron-right"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>




<ng-template #aboutCandidateDialog>
  <div class="animate-zoom">
    <div class="container">
      <div class="row mb-2 align-items-center">
        <div class="col-md-9">
          <div class="d-flex ">
            <span class="small text-uppercase mr-2">
              Name: {{ candidateData?.candidatePersonalInformationDetails?.firstName }}
            </span>
            <span class="small text-muted mr-2">|</span>

            <span class="small text-uppercase mr-2">
              Job Code: {{ candidateData?.candidatePersonalInformationDetails?.jcReferanceId }}
            </span>
            <span class="small text-muted mr-2">|</span>

            <span class="small text-uppercase">
              Designation: {{ candidateData?.candidatePersonalInformationDetails?.designationName }}
            </span>
          </div>

          <span *ngIf="!candidateData?.candidatePersonalInformationDetails?.firstName"
            class="fw-bold custom-text">Details</span>
        </div>
        <div class="col-md-3 d-flex justify-content-end align-items-center">
          <!-- <button *ngIf="disableFeedBack" type="button"
            class="border-none custom-bg text-white custom-action-btn px-2 py-1 mr-2" (click)="viewFeedbackForm()">
            Feedback Form
          </button> -->
          <button type="button" class="btn btn-sm shadow-none " (click)="close()">
            <i class="bi bi-x-circle fs-5 text-danger" (click)="close()"></i>
          </button>
        </div>
      </div>
      <hr class="m-0 p-0 text-dark border mb-2">

      <div *ngIf="candidateData?.candidatePersonalInformationDetails?.firstName; else noCandidateData"
        class="scroll-container container">
        <div class="card p-2 mb-3" style="font-size:12px;">
          <h6 class=" mb-2" style="font-weight:600;">Basic Details : </h6>

          <table class="table table-bordered table-sm mb-0" style="width:100%; margin:0; line-height:1.3;">
            <tbody>
              <tr>
                <th style="width:20%; background-color:#f8f9fa; font-weight:600;">Name</th>
                <td style="width:30%;">
                  {{ candidateData?.candidatePersonalInformationDetails?.firstName }}
                  {{ candidateData?.candidatePersonalInformationDetails?.lastName }}
                </td>
                <th style="width:20%; background-color:#f8f9fa; font-weight:600;">Highest Degree</th>
                <td style="width:30%;">
                  {{ candidateData?.candidatePersonalInformationDetails?.highestDegree || 'N/A' }}
                </td>
              </tr>

              <tr>
                <th style="background-color:#f8f9fa; font-weight:600;">Mobile</th>
                <td>{{ candidateData?.candidatePersonalInformationDetails?.mobileNumber }}</td>
                <th style="background-color:#f8f9fa; font-weight:600;">Date of Birth</th>
                <td>{{ candidateData?.candidatePersonalInformationDetails?.dob }}</td>
              </tr>

              <tr>
                <th style="background-color:#f8f9fa; font-weight:600;">Email</th>
                <td>{{ candidateData?.candidatePersonalInformationDetails?.email }}</td>
                <th style="background-color:#f8f9fa; font-weight:600;">Aadhar</th>
                <td>{{ candidateData?.candidatePersonalInformationDetails?.adhar }}</td>
              </tr>

              <tr>
                <th style="background-color:#f8f9fa; font-weight:600;">Experience Type</th>
                <td>
                  {{ candidateData?.candidatePersonalInformationDetails?.isFresher ? 'Fresher' : 'Experienced' }}
                </td>
                <th style="background-color:#f8f9fa; font-weight:600;">Resume</th>
                <td>
                  <ng-container *ngIf="resumeFile">
                    <!-- <button class="btn btn-outline-primary btn-sm w-100 small" style="padding:2px 4px;"
                      (click)="viewFile(resumeFile)">
                      View Resume
                    </button> -->
                    <span class="badge custom-bg text-white cursor-pointer p-1" (click)="viewFile(resumeFile)">View
                      Resume</span>
                  </ng-container>
                  <span *ngIf="!resumeFile">N/A</span>
                </td>
              </tr>

              <tr *ngIf="!candidateData?.candidatePersonalInformationDetails?.isFresher">
                <th style="background-color:#f8f9fa; font-weight:600;">Company Name</th>
                <td>{{ candidateData?.candidatePersonalInformationDetails?.companyName || 'N/A' }}</td>
                <th style="background-color:#f8f9fa; font-weight:600;">Total Experience</th>
                <td>{{ candidateData?.candidatePersonalInformationDetails?.totalExperience || 'N/A' }}</td>
              </tr>
            </tbody>
          </table>
        </div>





        <div class="card p-2 mb-3">
          <span class="text-dark mb-1">
            <strong>Interview Details : </strong>
          </span>

          <div class="table-container">
            <table class="table table-bordered table-sm mb-0" style="width:100%; margin:0; line-height:1.2;">
              <thead>
                <tr>
                  <th class="custom-th small-header">S.No</th>
                  <th class="custom-th small-header">Interview Date</th>
                  <th class="custom-th small-header">Interview Time</th>
                  <th class="custom-th small-header">Interviewer</th>
                  <th class="custom-th small-header">Round Name</th>
                  <th class="custom-th small-header">Interview Type</th>
                  <th class="custom-th small-header">Status</th>
                  <th class="custom-th small-header">Feedback</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let exp of candidateData.candidateInterviewDetails">
                  <tr *ngIf="exp.interviewScheduleId">
                    <td class="custom-td small-header">{{ exp.roundNo || 'NA' }}</td>
                    <td class="custom-td small-header">
                      {{ exp?.interviewDate ? (convertToDateObject(exp.interviewDate) | date:'dd-MMM-yyyy') : '--' }}
                    </td>

                    <td class="custom-td small-header">{{ exp.interviewTime || 'NA' }}</td>
                    <td class="custom-td small-header">
                      {{ (exp.interviewByName ? exp.interviewByName : 'NA') }} - {{ (exp.interviewBy ? exp.interviewBy :
                      'NA') }}
                    </td>
                    <td class="custom-td small-header">
                      {{ exp.level || 'NA' }} ({{ exp.interviewRoundName || 'Initial' }})
                    </td>
                    <td class="custom-td small-header text-break" [attr.title]="exp.locationName || 'Online'"
                      style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"
                      data-bs-toggle="tooltip" data-bs-placement="top">
                      {{ exp.modeId === 1 ? "Offline" : exp.modeId === 2 ? "Online" : "Telephonic"}}
                    </td>

                    <td class="custom-td small-header" [ngSwitch]="exp.status">
                      <span *ngSwitchCase="1001" class="text-warning">Pending</span>
                      <span *ngSwitchCase="1002" class="text-danger">Cancelled</span>
                      <span *ngSwitchCase="1004" class="text-success">Approved</span>
                      <span *ngSwitchCase="1005" class="text-danger">Rejected</span>
                      <span *ngSwitchCase="1006" class="text-info">Hold</span>
                      <span *ngSwitchDefault>{{ exp.status || 'NA' }}</span>
                    </td>
                    <td class="custom-td small-header text-break">
                      <ng-container *ngIf="exp.candidateInterviewFeedBackDTO?.length > 0; else pending">
                        <button class="btn btn-sm custom-bg text-white text-break" (click)="feedbackView(
                          exp,
                          candidateData?.candidatePersonalInformationDetails?.firstName || 'NA',
                          candidateData?.candidatePersonalInformationDetails?.email || 'NA')">
                          View
                        </button>
                      </ng-container>
                      <ng-template #pending>
                        <span class="text-warning">Pending</span>
                      </ng-template>
                    </td>
                  </tr>

                </ng-container>
              </tbody>

            </table>
          </div>


          <!-- Show message if no interview details are available -->
          <div *ngIf="!candidateData?.candidateInterviewDetails?.length" class="text-muted text-center">
            No interview details available.
          </div>
        </div>
      </div>


      <ng-template #noCandidateData>
        <div class="alert alert-warning text-center">
          No Candidate data available.
        </div>
      </ng-template>
    </div>
  </div>
</ng-template>

<div *ngIf="showPDF" class="overlay">
  <div class="pdf-container">
    <button class="close-btn" (click)="closePDF()">âœ–</button>
    <iframe [src]="fileURL" width="100%" height="100%"></iframe>
  </div>
</div>




<div class="loader attDnceLoadr" *ngIf="isLoading">
  <div class="spinner">
    <div class="bounce1"></div>
    <div class="bounce2"></div>
    <div class="bounce3"></div>
  </div>
</div>